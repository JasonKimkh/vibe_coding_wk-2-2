name: ì´ìŠˆ ìë™ í• ë‹¹

on:
  issues:
    types: [opened, labeled]

jobs:
  auto-assign:
    runs-on: ubuntu-latest
    
    steps:
    - name: ë¼ë²¨ì— ë”°ë¥¸ ìë™ ë‹´ë‹¹ì í• ë‹¹
      uses: actions/github-script@v7
      with:
        script: |
          const issue = context.payload.issue;
          const labels = issue.labels.map(label => label.name);
          const title = issue.title.toLowerCase();
          const body = issue.body ? issue.body.toLowerCase() : '';
          
          // ë¼ë²¨ë³„ ë‹´ë‹¹ì ë§¤í•‘ (ì‹¤ì œ GitHub ì‚¬ìš©ìëª…ìœ¼ë¡œ ìˆ˜ì • í•„ìš”)
          const assigneeMap = {
            'bug': ['backend-developer', 'qa-engineer'],
            'feature-request': ['product-manager', 'backend-developer'],
            'enhancement': ['backend-developer'],
            'documentation': ['tech-writer', 'backend-developer'],
            'testing': ['qa-engineer'],
            'backend': ['backend-developer'],
            'frontend': ['frontend-developer'],
            'ai-ml': ['ml-engineer'],
            'api': ['backend-developer'],
            'urgent': ['team-lead'],
            'priority-high': ['team-lead'],
            'good-first-issue': ['mentor']
          };
          
          // í‚¤ì›Œë“œë³„ ë‹´ë‹¹ì ë§¤í•‘
          const keywordMap = {
            'langgraph': ['ml-engineer'],
            'fastapi': ['backend-developer'],
            'streamlit': ['frontend-developer'],
            'test': ['qa-engineer'],
            'deploy': ['devops-engineer'],
            'database': ['backend-developer'],
            'api': ['backend-developer']
          };
          
          let assignees = new Set();
          
          // ë¼ë²¨ ê¸°ë°˜ í• ë‹¹
          labels.forEach(label => {
            if (assigneeMap[label]) {
              assigneeMap[label].forEach(assignee => assignees.add(assignee));
            }
          });
          
          // í‚¤ì›Œë“œ ê¸°ë°˜ í• ë‹¹
          Object.entries(keywordMap).forEach(([keyword, users]) => {
            if (title.includes(keyword) || body.includes(keyword)) {
              users.forEach(user => assignees.add(user));
            }
          });
          
          // ìš°ì„ ìˆœìœ„ì— ë”°ë¥¸ ì¶”ê°€ í• ë‹¹
          if (labels.includes('urgent') || labels.includes('priority-high')) {
            assignees.add('team-lead');
          }
          
          // ê¸°ë³¸ ë‹´ë‹¹ì (ë¼ë²¨ì´ ì—†ê±°ë‚˜ ë§¤ì¹­ë˜ì§€ ì•ŠëŠ” ê²½ìš°)
          if (assignees.size === 0) {
            assignees.add('default-maintainer');
          }
          
          // ë‹´ë‹¹ì í• ë‹¹ (ìµœëŒ€ 3ëª…)
          const finalAssignees = Array.from(assignees).slice(0, 3);
          
          if (finalAssignees.length > 0) {
            await github.rest.issues.addAssignees({
              owner: context.repo.owner,
              repo: context.repo.repo,
              issue_number: context.issue.number,
              assignees: finalAssignees
            });
            
            console.log(`ë‹´ë‹¹ìë¡œ ${finalAssignees.join(', ')}ë¥¼ í• ë‹¹í–ˆìŠµë‹ˆë‹¤.`);
          }

  priority-assign:
    runs-on: ubuntu-latest
    
    steps:
    - name: ìš°ì„ ìˆœìœ„ì— ë”°ë¥¸ íŠ¹ë³„ í• ë‹¹
      uses: actions/github-script@v7
      with:
        script: |
          const issue = context.payload.issue;
          const title = issue.title.toLowerCase();
          const body = issue.body ? issue.body.toLowerCase() : '';
          const labels = issue.labels.map(label => label.name);
          
          // ê¸´ê¸‰ í‚¤ì›Œë“œ ì²´í¬
          const urgentKeywords = ['ê¸´ê¸‰', 'urgent', 'critical', 'í¬ë¦¬í‹°ì»¬', 'ì¥ì• ', 'down', 'ì„œë¹„ìŠ¤', 'production'];
          const isUrgent = urgentKeywords.some(keyword => 
            title.includes(keyword) || body.includes(keyword)
          );
          
          if (isUrgent && !labels.includes('urgent')) {
            // ê¸´ê¸‰ ë¼ë²¨ ì¶”ê°€
            await github.rest.issues.addLabels({
              owner: context.repo.owner,
              repo: context.repo.repo,
              issue_number: context.issue.number,
              labels: ['urgent', 'priority-high']
            });
            
            // íŒ€ ë¦¬ë” ë° ì˜¨ì½œ ì—”ì§€ë‹ˆì–´ì—ê²Œ í• ë‹¹
            await github.rest.issues.addAssignees({
              owner: context.repo.owner,
              repo: context.repo.repo,
              issue_number: context.issue.number,
              assignees: ['team-lead', 'on-call-engineer']
            });
            
            // ê¸´ê¸‰ ì•Œë¦¼ ëŒ“ê¸€
            await github.rest.issues.createComment({
              issue_number: context.issue.number,
              owner: context.repo.owner,
              repo: context.repo.repo,
              body: `ğŸš¨ **ê¸´ê¸‰ ì´ìŠˆë¡œ ë¶„ë¥˜ë˜ì—ˆìŠµë‹ˆë‹¤!**\n\níŒ€ ë¦¬ë”ì™€ ì˜¨ì½œ ì—”ì§€ë‹ˆì–´ì—ê²Œ ìë™ìœ¼ë¡œ í• ë‹¹ë˜ì—ˆìŠµë‹ˆë‹¤.\n24ì‹œê°„ ì´ë‚´ ì‘ë‹µ ì˜ˆì •ì…ë‹ˆë‹¤.`
            });
          } 